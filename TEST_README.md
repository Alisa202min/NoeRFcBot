# راهنمای تست‌های استعلام قیمت

این مستندات نحوه استفاده از تست‌های قابلیت استعلام قیمت هم در ربات تلگرام و هم در پنل مدیریت را شرح می‌دهد.

## فایل‌های تست

این پروژه شامل فایل‌های تست زیر است:

- `test_telegram_inquiry.py`: تست‌های مربوط به استعلام قیمت در ربات تلگرام
- `test_admin_inquiry.py`: تست‌های مربوط به استعلام قیمت در پنل مدیریت
- `test_inquiry_system.py`: تست‌های یکپارچه شامل هر دو بخش
- `test_logger.py`: کلاس ثبت و گزارش‌گیری از نتایج تست‌ها
- `test_inquiry_automation.py`: اسکریپت اتوماسیون تست‌ها
- `run_inquiry_tests.py`: اسکریپت ساده‌تر برای اجرای تست‌ها

## نحوه اجرای تست‌ها

### روش 1: اجرا با اسکریپت اتوماسیون (توصیه شده)

اسکریپت `test_inquiry_automation.py` به صورت خودکار تمام تست‌ها را اجرا کرده و گزارش کاملی تولید می‌کند:

```bash
python test_inquiry_automation.py
```

پارامترهای اختیاری:

- `--components`: کامپوننت‌هایی که باید تست شوند (`all`, `telegram`, `admin`)
- `--verbose`: نمایش جزئیات بیشتر
- `--no-html`: عدم تولید گزارش HTML

مثال‌ها:

```bash
# اجرای فقط تست‌های ربات تلگرام
python test_inquiry_automation.py --components telegram

# اجرای فقط تست‌های پنل مدیریت با جزئیات بیشتر
python test_inquiry_automation.py --components admin --verbose

# اجرای همه تست‌ها بدون تولید گزارش HTML
python test_inquiry_automation.py --no-html
```

### روش 2: اجرا با اسکریپت ساده

فایل `run_inquiry_tests.py` یک اسکریپت ساده‌تر برای اجرای تست‌ها است:

```bash
python run_inquiry_tests.py
```

پارامترهای اختیاری:

- `--type`: نوع تست‌ها برای اجرا (`all`, `telegram`, `admin`)
- `--verbose`: نمایش جزئیات بیشتر

### روش 3: اجرای مستقیم هر فایل تست

می‌توانید هر فایل تست را به صورت مستقیم اجرا کنید:

```bash
# تست‌های ربات تلگرام
python test_telegram_inquiry.py

# تست‌های پنل مدیریت
python test_admin_inquiry.py

# تست‌های یکپارچه
python test_inquiry_system.py
```

## گزارش‌های تست

گزارش‌های تست به صورت خودکار در پوشه `test_results` ذخیره می‌شوند. دو نوع گزارش تولید می‌شود:

1. گزارش JSON: شامل تمام جزئیات نتایج تست‌ها
2. گزارش HTML: نسخه گرافیکی و قابل مشاهده در مرورگر

## چک کردن خطاها

در صورت بروز خطا در تست‌ها:

1. به گزارش HTML مراجعه کنید که جزئیات خطاها را نشان می‌دهد
2. از پارامتر `--verbose` برای دریافت اطلاعات بیشتر استفاده کنید
3. فایل لاگ اصلی را بررسی کنید که خطاها در آن ثبت می‌شوند

## نکات مهم برای توسعه دهندگان

### تست‌های ربات تلگرام

- از کلاس‌های موک برای شبیه‌سازی ربات تلگرام استفاده می‌کند
- نیازی به اتصال واقعی به API تلگرام ندارد
- تست‌ها به صورت asyncio اجرا می‌شوند

### تست‌های پنل مدیریت

- از `Flask-Testing` برای تست کردن واسط کاربری وب استفاده می‌کند
- دیتابیس SQLite در حافظه برای تست‌ها استفاده می‌شود
- نیازی به دیتابیس واقعی PostgreSQL ندارد

### افزودن تست‌های جدید

برای افزودن تست جدید به ربات تلگرام:

1. کلاس `TestTelegramInquiry` در `test_telegram_inquiry.py` را گسترش دهید
2. تابع تست جدید با پیشوند `test_` اضافه کنید

برای افزودن تست جدید به پنل مدیریت:

1. کلاس `AdminInquiryTest` در `test_admin_inquiry.py` را گسترش دهید
2. تابع تست جدید با پیشوند `test_` اضافه کنید