{% extends "admin_layout.html" %}
{% set active_page = 'categories' %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h4>{% if category %}ویرایش دسته‌بندی{% else %}افزودن دسته‌بندی جدید{% endif %}</h4>
    </div>
    <div class="card-body">
        <form method="post" action="{% if category %}/admin/categories/edit/{{ category.id }}{% else %}/admin/categories/add{% endif %}">
            <div class="mb-3">
                <label for="name" class="form-label">نام دسته‌بندی</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ category.name if category else '' }}" required>
            </div>
            
            <div class="mb-3">
                <label for="parent_id" class="form-label">دسته‌بندی والد</label>
                <select class="form-select" id="parent_id" name="parent_id">
                    <option value="">بدون والد (دسته‌بندی اصلی)</option>
                    {% for parent in all_categories %}
                        {% if not category or parent.id != category.id %}
                            <option value="{{ parent.id }}" {{ 'selected' if category and category.parent_id == parent.id else '' }}>
                                {{ parent.name }} {{ '(محصولات)' if parent.cat_type == 'product' else '(خدمات)' }}
                            </option>
                        {% endif %}
                    {% endfor %}
                </select>
                <div class="form-text">در صورت انتخاب، این دسته‌بندی به عنوان زیرگروه دسته‌بندی انتخاب شده در نظر گرفته می‌شود.</div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">نوع دسته‌بندی</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="cat_type" id="type_product" value="product" {{ 'checked' if not category or category.cat_type == 'product' else '' }}>
                    <label class="form-check-label" for="type_product">
                        محصولات
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="cat_type" id="type_service" value="service" {{ 'checked' if category and category.cat_type == 'service' else '' }}>
                    <label class="form-check-label" for="type_service">
                        خدمات
                    </label>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <a href="/admin/categories" class="btn btn-secondary">انصراف</a>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> ذخیره
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}